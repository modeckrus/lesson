on: [push, pull_request]
name: Test
jobs:
    golangci:
    name: lint
    runs-on: ubuntu-latest
    continue-on-error: true # в некоторых случаях это допустимо
    steps:
      - uses: actions/checkout@v2
      - name: golangci-lint
        uses: golangci/golangci-lint-action@v2
        with:
          version: v1.39
    test:
    needs: [golangci] # зависит от linter
    strategy:
      matrix:
        go-version: [1.16.x]
        os: [ubuntu-latest]
    runs-on: ${{ matrix.os }}
    steps:
      - name: Install Go
        uses: actions/setup-go@v2
        with:
          go-version: ${{ matrix.go-version }}
      - name: Checkout code
        uses: actions/checkout@v2
      - name: Unit tests
        run: go test ./... -v -covermode=count  # запускаем тесты 
#     strategy:
#       matrix:
#         go-version: [1.16.x, 1.17.x]
#         os: [ubuntu-latest, macos-latest, windows-latest]
#     runs-on: ${{ matrix.os }}
#     steps:
#     - name: Install Go
#       uses: actions/setup-go@v2
#       with:
#         go-version: ${{ matrix.go-version }}
#     - name: Checkout code
#       uses: actions/checkout@v2
#     - name: Test
#       run: go test ./...

#   test-cache:
#     runs-on: ubuntu-latest
#     steps:
#     - name: Install Go
#       uses: actions/setup-go@v2
#       with:
#         go-version: 1.17.x
#     - name: Checkout code
#       uses: actions/checkout@v2
#     - uses: actions/cache@v2
#       with:
#         # In order:
#         # * Module download cache
#         # * Build cache (Linux)
#         # * Build cache (Mac)
#         # * Build cache (Windows)
#         path: |
#           ~/go/pkg/mod
#           ~/.cache/go-build
#           ~/Library/Caches/go-build
#           %LocalAppData%\go-build
#         key: ${{ runner.os }}-go-${{ hashFiles('**/go.sum') }}
#         restore-keys: |
#           ${{ runner.os }}-go-
#     - name: Test
#       run: go test ./...